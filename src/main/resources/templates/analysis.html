<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>bilibili comments analysis</title>
    <meta name="author" content="FattyDelivery">
    <meta name="description" content="bilibili弹幕分析">
    <meta name="keywords" content="bilibili,弹幕,弹幕分析">
    <link rel="icon" th:href="@{img/logo_square.png}"> <!-- sizes="196x196" -->
    <link rel="shortcut icon" th:href="@{img/logo_square.png}">
    <link rel="shortcut icon" th:href="@{img/logo_square.png}">
    <link rel="apple-touch-icon-precomposed" th:href="@{img/logo_square.png}"/>
    <link rel="stylesheet" type="text/css" th:href="@{css/main.min.css}"/>
    <link rel="stylesheet" type="text/css"
          href="https://fonts.googleapis.com/css?family=Noto+Sans+SC:400,700&display=swap?subset=chinese-simplified">

    <script type="text/javascript" th:src="@{js/jquery-3.4.1.js}"></script>
    <script type="text/javascript" th:src="@{js/echarts.min.js}"></script>

    <link rel="stylesheet" type="text/css" th:href="@{css/my.css}"/>

    <script>
        var t = {
            getQueryString: function (name) {
                var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
                var r = window.location.search.substr(1).match(reg);
                if (r != null)
                    return decodeURI(r[2]);
                return null;
            }
        }

        //调用
        var bvid = t.getQueryString("bvid"); //bvid

        $.ajax({
            type: 'get',
            url: '/getinfo',
            data: {bvid: bvid},
            dataType: 'json',
            success: function (data) {
                // alert(data.bvid)
                // alert(data.cid)
                var html_info = $("#video-info").html()
                html_info += "<p>bvid: " + data.bvid + "</p>"
                html_info += "<p>cid: " + data.cid + "</p>"
                $("#video-info").html(html_info);
            }
        });

        $.ajax({
            type: 'get',
            url: '/getcomments',
            data: {bvid: bvid},
            dataType: 'json',
            success: function (data) {
                // alert(data.bvid)
                // alert(data.cid)
                var html_table = $("#comments-list").html();
                html_table += '<div id="comments-table">';
                html_table += '<table>';
                html_table += '<tbody>';
                for(var p in data){ //遍历json对象的每个key/value对,p为key
                    html_table += '<tr><td style="width: 10%;">' + p + '</td><td>' + data[p].commentText + '</td></tr>';
                }
                html_table += '</tbody>';
                html_table += '</table>';
                html_table += '</div>';

                $("#comments-list").html(html_table);
            }
        });

    </script>


</head>
<body class="index" style="scroll: auto;">
<div id="menu"><i></i></div>
<div id="content">
    <div id="top-menu-list">
        <ul id="top-menu-ul">
            <li><a href="/">首页</a></li>
            <li><a href="nav">导航</a></li>
            <li><a href="admin">管理</a></li>
            <li><a href="about">关于</a></li>
        </ul>
    </div>
    <div id="site-main">
        <div id="container">
            <p class="my-title" style="padding: 80px 0 0">Video Information</p>
            <div id="video-info">
            </div>
            <p class="my-title">Comments List</p>
            <div id="comments-list">
            </div>
            <p class="my-title">Heatmap</p>
            <div id="analysis-heatmap">
            </div>
            <p class="my-title">WordCount</p>
            <div id="analysis-wordcount">
            </div>
        </div>
    </div>
    <div id="foot">©2020-2021
        <a href="https://github.com/fattydelivery" target="_blank" class="out_link">FattyDelivery.</a> All rights
        reserved.
        <a href="https://github.com/fattydelivery" target="_blank" style="font-size: 12px;">
            <span class="tag_box">v0.0.1</span></a>
    </div>
</div>
</body>
<script th:src="@{js/jsondata.js}"></script>
<script th:src="@{js/main.min.js}"></script>
<script th:src="@{js/menu.min.js}"></script>
</html>